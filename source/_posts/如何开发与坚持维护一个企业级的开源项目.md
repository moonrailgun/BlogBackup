---
title: 如何开发与坚持维护一个企业级的开源项目
tags:
  - typescript
abbrlink: 28f21ef5
date: 2020-12-14 15:03:11
---

[TRPG Engine](https://github.com/TRPGEngine/Client) 是我一直坚持维护的一个开源项目。正如所有的开源项目都起源于开发者的兴趣，`TRPG Engine`也是我对于跑团这一小众领域的兴趣。

我个人，在没有支援没有赞助，单凭个人爱好独立坚持开发3年以上不间断。前端代码累计提交2700+, 后端代码累计提交1200+

谨以此文，分享一下我维护这个开源项目的经历。并与千千万万独立坚持的开源人共勉。

## 起初

所有的个人项目都起源于想做。因为我想做，因此我建立了这样的项目。最初的目的很单纯，就是作为我学习React的一个实践。

最初选用的技术栈是`React` + `Redux`。之所以用`React`是为了可以共享一部分的代码到`React Native`, 这样的搭配会很大的减少重复逻辑的开发与后期的维护，以减少成本。

> 而事实是我在两者共存与中间代码上花费了很多的精力，写了很多中间脚本使网页版与RN版能够相互协作。

## 开发

因为技术在不断更新。而有的库又逐步步入生命周期的终结，很多情况不得不花费时间去迁移。

`TRPG Engine`经历过几次大的迁移/迭代:

- 原来`TRPG Engine`的后端是使用的[node-orm2](https://github.com/dresende/node-orm2). 然后这个库被弃用了。因此花了很大经历将其迁移到[sequelize](https://github.com/sequelize/sequelize)，包括代码的修改与数据库的变更。这个没什么好分享的，纯粹是当时的选择有限，而库的生命周期比较短。
- 最早的`TRPG Engine`使用的是用纯粹的js写的，但是随着业务的不断增多，代码复杂度的变高，我选择使用[Typescript](https://www.typescriptlang.org/)对我的项目进行重构。从长远来看这一步是非常值得的，TS的类型系统长远的帮助到了一个项目的健康发展。（其实有点小遗憾，从目前的角度来看flow在一些细节做得比ts更加好）。
- 从`React ClassComponent` 到 `React Hooks`: hooks无疑拥有更高的抽象性，使用Hooks能抛弃HOC这种很难被typescript支持的写法。同时更方便代码的复用，特别是对于React和React Native代码并存的项目来说。
- 前端重构, 重写界面。原来的TRPG Engine是参考的钉钉设计的，但实际的迭代中，频道的需求更为突出。即需要由原来的单层消息列表变成双层消息列表。因此花费了几个月时间写了一版类似于`Discord`设计的新版页面，并且颜色也从原来的亮色变成保护眼睛的暗色。

### 善用单元测试

为了一个项目的长远发展，测试用例与持续集成都是必要的。特别是单元测试，在很多时候能帮助到项目的提前预知问题。坚持每个bug都有一个对应的单元测试用例，防止再次出现类似的问题。

### 学会数据迁移

为了方便数据库的升级，自己fork了一个[sequelize-auto-migrations](https://github.com/TRPGEngine/sequelize-auto-migrations)库用于生成数据库的迁移脚本, 因为原作者已经不维护了。

数据库迁移脚本可以保证在任意环境下都能生成正确的数据库格式。这对于关系型数据库来说非常重要。

### 兴趣是原始驱动力

与商业项目不同的是，个人项目可以把一切自己感兴趣、想做的东西都想办法以某种形式糅合到自己的项目中。

`TRPG Engine`就拥有这些有意思的系统:

- 基于xml描述与js沙盒的动态计算的表单系统
- 基于[slate](https://github.com/ianstormtaylor/slate)实现的笔记系统与富文本输入框
- 基于meta信息的动态面板
- 基于BBCode的消息解释器

### 自己是第一用户

对于个人项目来说，自己才是自己产品最忠实的用户，只有这样才能不断发掘产品的不足，并不断改善。如果自己都不想用自己的产品，那么这个产品还有存在的必要么？

### 维护自己的门面

如果一个项目想要宣传，一个门面则非常重要。这可能是一个README, 一片文章，一个官网。但是如果没有任何说明，告诉别人这是什么，你在做什么。又能期待谁来阅读你的源码呢？

## 维护

为了维护与运营这个项目，唯一的支出就是在服务器和OSS上了，零零散散也花费了几千元在上面了。一台2核4G的主服务器, 在主服务器上运行Mysql, Redis与Mysql。另外还有一台1核1G的小型服务器作为语音服务器与测试服务器。前端的代码都是本地编译好后提交到第三方对象存储上，这样用户的访问会更加迅速与快捷。

## 赞助?

曾经也考虑过要不要和别人一样放出二维码，看看能不能获得一些打赏，后来想了想还是算了。一方面没有多少的关注，我本人也比较低调不善于宣传。另一方面感觉，掺杂了利益后的开源项目，总感觉失去了纯粹性。爱好只能是爱好，如果成为一种牟利方式，那么可能就不像当初那么纯粹了。

## 感谢

最后感谢所有开源作者的无私奉献，正是你们存在才能让这个互联网世界变得更加精彩。
